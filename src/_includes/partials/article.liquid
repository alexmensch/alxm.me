<article class="[ article ] [ flow flow-space-m ]">
  {% render "partials/hero"
            hero: hero,
            type: type,
            header: header,
            byline: byline,
            site: site      %}

  <div class="[ article__content ] [ flow ]">
    {% if type == "episode" %}
      {% render "partials/media-player", label: "Listen", src: recording %}
    {% endif %}
    {{ content }}
  </div>

  {% if type == "writing" %}
    {% comment %}
    Groups items by year, then partials/writing-collection renders a year and its items
    {% endcomment %}

    {% assign items_with_dates = writing_collection | where: "date" %}
    {% assign years_map = "" | split: "" %}
    {% assign unique_years = "" | split: "" %}

    {% for item in items_with_dates %}
      {% assign item_year = item.date | date: "%Y" | plus: 0 %}
      {% unless unique_years contains item_year %}
        {% assign unique_years = unique_years | push: item_year %}
      {% endunless %}
    {% endfor %}

    {% assign sorted_years = unique_years | sort | reverse %}

    {% for year in sorted_years %}
      {% assign year_items = "" | split: "" %}
      
      {% for item in items_with_dates %}
        {% assign item_year = item.date | date: "%Y" | plus: 0 %}
        {% if item_year == year %}
          {% assign year_items = year_items | push: item %}
        {% endif %}
      {% endfor %}

      {% assign year_items = year_items | sort: "date" %}
      {% render "partials/writing-collection", collection: year_items, year: year %}
    {% endfor %}
  {% endif %}

  {% if type == "landing" and cta %}
    {% render "partials/cta", cta: cta %}
  {% endif %}

  {% if type == "contact" %}
    {% render "partials/contact-options", options: options %}
  {% endif %}

  {% if type == "podcast" %}
    {% for episode in episodes %}
      {% if episode.data.publishToRSSFeed %}
        {% render "partials/podcast-collection", episode: episode %}
      {% endif %}
    {% endfor %}
  {% endif %}
</article>